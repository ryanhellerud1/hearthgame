<!DOCTYPE html>
<html>
<title>Hearth Test</title>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	    <meta name="description" content="Demo project with jQuery">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css">	
		<style type="text/css">
		.bold{
			font-weight: bold; 
		}
		.board{
			height: 50%;
			width:75%;
			display:inline-block;
			float:left;
			background-color: red;
			
		}

		.hand{
			height: 50%;
			width:75%;
			display:inline-block;
			float:left;
			background-color: pink;
			
		}

		.buttons{
			display: block;
		}

		.player{
			height: 50%;
			width:50%;
			display:inline-block;
			float:left;
			
		}
		
		
		</style>
	</head>
	<body>
	<!-- 	<button id='juggler'> Juggler</button>
		<button id='add'> Add Card</button>
 -->
<div class="player">

	<button class='endTurn'> End Turn</button>

	<div class="manaarea">
		Mana crystals: <span class="mana mana1">1</span>
	</div>

	<div class='board'>
	</div>

	<div class='hand'>
	</div>

</div>

		
<div class="player">

	<button class='endTurn'> End Turn</button>

	<div class="manaarea">
		Mana crystals: <span class="mana mana2">1</span>
	</div>

	<div class='board'>
	</div>

	<div class='hand'>
	</div>

</div>

	</body>
	<script src="http://code.jquery.com/jquery-1.10.2.min.js"></script>
	<script type="text/javascript">

			function Creature(name, mana, atk, hp, prop){
				this.name = name;
				this.mana = mana;
				this.atk = atk;
				this.hp = hp;
				this.prop = prop;
			}



			player1 = {
				name: 'you',
				deck:[],
				hand: [],
				board:[],
				currentMana: 1,
				totalMana: 1,
				elBoard: $('.board').eq(0),
				elHand: $('.hand').eq(0)
			};

			player2 = {
				name: 'opponent',
				deck: [],
				hand:  [],
				board: [],
				currentMana: 0,
				totalMana: 0,
				elBoard: $('.board').eq(1),
				elHand: $('.hand').eq(1)
			};


			var players = [];

			players[0] = {
				name: 'you',
				deck:[],
				hand: [],
				board:[],
				currentMana: 1,
				totalMana: 1,
				elBoard: $('.board').eq(0),
				elHand: $('.hand').eq(0)
			};

			players[1] = {
				name: 'opponent',
				deck: [],
				hand:  [],
				board: [],
				currentMana: 0,
				totalMana: 0,
				elBoard: $('.board').eq(1),
				elHand: $('.hand').eq(1)
			};


			player1.deck[0] = new Creature('Knife Juggler',2,  2, 2, 'juggle knife');
			player1.deck[1]  = new Creature('Tirion',8, 6, 6, 'taunt');
			player1.deck[2]  = new Creature('Eadric the Pure',7, 3, 7);
			player1.deck[3] = new Creature('Aviana',9, 5, 5);
			player1.deck[4]  = new Creature('Tristana',1, 6, 2);

			player2.deck[0] = new Creature('Kelthusad',8,  6, 8, 'respawn');
			player2.deck[1]  = new Creature('Malzahar',2, 3, 9, 'taunt');
			player2.deck[2]  = new Creature('Farseer',3, 3, 3);
			player2.deck[3] = new Creature('Aviana',9, 5, 5);
			player2.deck[4]  = new Creature('Tristana',1, 6, 2);

			players[0].deck[0] = new Creature('Knife Juggler',2,  2, 2, 'juggle knife');
			players[0].deck[1]  = new Creature('Tirion',8, 6, 6, 'taunt');
			players[0].deck[2]  = new Creature('Eadric the Pure',7, 3, 7);
			players[0].deck[3] = new Creature('Aviana',9, 5, 5);
			players[0].deck[4]  = new Creature('Tristana',1, 6, 2);

			players[1].deck[0] = new Creature('Kelthusad',8,  6, 8, 'respawn');
			players[1].deck[1]  = new Creature('Malzahar',2, 3, 9, 'taunt');
			players[1].deck[2]  = new Creature('Farseer',3, 3, 3);
			players[1].deck[3] = new Creature('Aviana',9, 5, 5);
			players[1].deck[4]  = new Creature('Tristana',1, 6, 2);

	
/////////////////////// Turn
			$('.endTurn').on('click', function(){

					var index = $(this).index('.endTurn');
					$(this).hide();

					$('.endTurn').eq(1-index).show()

					players[1-index].totalMana++;
					players[1-index].currentMana = players[1-index].totalMana;
					//$('.hand .playcard').eq(0).hide();
					$(this).siblings('.hand').children('.playcard').hide();
					updatePlayer(players[1-index]);	
					draw(players[1-index].hand, players[1-index].deck, players[1-index].elHand);
			})


//////////////////////// CAST/PLAY CARD
			$(document).on( 'click', '.playcard', function(){
				var playerIndex = $(this).parent().parent().index('.player');
				var index = $(this).parent().children('.playcard').index(this);
				if(players[playerIndex].hand.length === 0){
				alert('hand empty');

				}else{
					card = players[playerIndex].hand[index];

					//Check mana
					if(players[playerIndex].currentMana >= card.mana){
						players[playerIndex].currentMana -= card.mana;
						players[playerIndex].hand.splice(index,1);
					   	players[playerIndex].board.push(card);
					   	updateBoard(players[playerIndex].board, players[playerIndex].elBoard);
					   	updateHand(players[playerIndex].hand, players[playerIndex].elHand);
					   	updatePlayer(players[playerIndex]);					
					   } else {
					   		alert("Not enough mana");
					   }
			   	}
			})



/////////////////////////FUNCTIONS

				function hpCheck(board){
				  for(var i = 0; i <board.length; i++){
				    if(board[i].hp < 1){
				      board.splice(i,1);
				    }
				  }
				}

				function updateBoard(board, player){
					//update board
				  player.html('');
				  for(var i = 0; i<board.length;i++){
				     player.append(' ');
				      for(var k in board[i]){
				        var temp = k;
				        if(temp === 'name'){
				          temp = '';
				          player.append("<span class='bold'>"+ temp+" " + board[i][k] + "</span><br>");
				        }else{
				         player.append(k+": " + board[i][k]+"<br>");
				        }
				      }
				  }
				}

				  function updateHand(playerHand, playerHandEl){
				  	playerHandEl.html('');
					  for(var i = 0; i<playerHand.length;i++){
					     playerHandEl.append('<button class="playcard">Play</button>');
					      for(var k in playerHand[i]){
					        var temp = k;
					        if(temp === 'name'){
					          temp = '';
					          playerHandEl.append("<span class='bold'>"+ temp+" " + playerHand[i][k] + "</span><br>");
					        }else{
					         playerHandEl.append(k+": " + playerHand[i][k]+"<br>");
					        }
					      }
					  }
				}

				function updatePlayer(player){
					if(player.name == 'you'){
						$('.mana1').text(player.currentMana);
					}
					if(player.name == 'opponent'){
						$('.mana2').text(player.currentMana);
					}
				}

				

///////////////JUGGLE
			// $('#juggle1').click(function(){
			//    	var hitNumber = Math.floor(Math.random() * (player2.board.length - 0));
			//    	if(player1.board.length<1){
			//    		alert('nothing on the board to hit');
			//    	}else{
			//   	juggle(player2.board[hitNumber], player2.board, player2.elBoard);
			//   	}
			// })

			// $('#juggle2').click(function(){
			//    	var hitNumber = Math.floor(Math.random() * (player1.board.length - 0));
			//    	if(player1.board.length < 1){
			//    		alert('nothing on the board to hit')
			//    	}else{
			//   	juggle(player1.board[hitNumber], player1.board, player1.elBoard);
			//   	}
			// })

				function juggle(creature, board, player){
					creature.hp--;
				  	hpCheck(board);
				  	updateBoard(board, player);
				}
			
				function draw(playerHand, playerDeck, playerHandEl){
					var index = Math.floor(Math.random() * (playerDeck.length));
					playerHand.push(playerDeck[index]);
					console.log('drew: ');
					console.log(playerDeck[index]);
					playerDeck.splice(index,1);
					updateHand(playerHand, playerHandEl)
				}

////////////// INIT
	for(var i=0; i<3; i++){
		draw(players[0].hand, players[0].deck, players[0].elHand);
		draw(players[1].hand, players[1].deck, players[1].elHand);		
	}
	//draw(player1.hand, player1.deck, player1.elHand);
	updatePlayer(players[0]);
	updatePlayer(players[1]);

	</script>
</html>