<!DOCTYPE html>
<html>
<title>Hearth Test</title>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	    <meta name="description" content="Demo project with jQuery">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css">	
		<style type="text/css">
		.bold{
			font-weight: bold; 
		}
		#board1{
			height: 50%;
			width:75%;
			display:inline-block;
			float:left;
			background-color: red;
			
		}
		#board2{
			height: 50%;
			width:75%;
			display:inline-block;
			float:left;
			background-color: red;
		}
		#hand1{
			height: 50%;
			width:75%;
			display:inline-block;
			float:left;
			background-color: pink;
			
		}
		#hand2{
			height: 50%;
			width:75%;
			display:inline-block;
			float:left;
			background-color: pink;
			
		}
		.buttons{
			display: block;
		}
		#player1{
			height: 50%;
			width:50%;
			display:inline-block;
			float:left;
			
		}
		
		
		#player2{
			height: 50%;
			width:50%;
			display:inline-block;
			float:left;
			
		}
		</style>
	</head>
	<body>
	<!-- 	<button id='juggler'> Juggler</button>
		<button id='add'> Add Card</button>
 -->
<div id="player1">
	<div class="buttons">
		<button id='juggle1'> Juggler</button>
		<button id='drawCard1'> Draw Card</button>
		<button class='endTurn'> End Turn</button>

	</div>

	<div class="manaarea">
		Mana crystals: <span class="mana mana1">1</span>
	</div>

	<div id='board1'>

	</div>
	<div id='hand1'>

	</div>
</div>

		
<div id="player2">
	<div class="buttons">
		<button id='juggle2'> Juggler</button>
		<button id='castCard2'> Cast Card</button>
		<button class='endTurn'> End Turn</button>
	</div>

	<div class="manaarea">
		Mana crystals: <span class="mana mana2">1</span>
	</div>

	<div id='board2'>

	</div>
	<div id='hand2'>

	</div>
</div>

	</body>
	<script src="http://code.jquery.com/jquery-1.10.2.min.js"></script>
	<script type="text/javascript">

			function Creature(name, mana, atk, hp, prop){
				this.name = name;
				this.mana = mana;
				this.atk = atk;
				this.hp = hp;
				this.prop = prop;
			}

			var player1= {
				name: 'you',
				deck:[],
				hand: [],
				board:[],
				currentMana: 1,
				totalMana: 1,
				elBoard: $('#board1'),
				elHand: $('#hand1'),
				turn: 1
			};
			var player2 = {
				name: 'opponent',
				deck: [],
				hand:  [],
				board: [],
				currentMana: 0,
				totalMana: 0,
				elBoard: $('#board2'),
				elHand: $('#hand2'),
				turn: 2
			};

			player1.deck[0] = new Creature('Knife Juggler',2,  2, 2, 'juggle knife');
			player1.deck[1]  = new Creature('Tirion',8, 6, 6, 'taunt');
			player1.deck[2]  = new Creature('Eadric the Pure',7, 3, 7);
			player1.deck[3] = new Creature('Aviana',9, 5, 5);
			player1.deck[4]  = new Creature('Tristana',1, 6, 2);

			player2.deck[0] = new Creature('Kelthusad',8,  6, 8, 'respawn');
			player2.deck[1]  = new Creature('Malzahar',2, 3, 9, 'taunt');
			player2.deck[2]  = new Creature('Farseer',3, 3, 3);
			player2.deck[3] = new Creature('Aviana',9, 5, 5);
			player2.deck[4]  = new Creature('Tristana',1, 6, 2);

			



// if(player1.turn % 2 === 0){
// 						$('.endTurn')[0].hide()
// 						}


	
/////////////////////// Turn
$('.endTurn').on('click', function(){
	if($(this).index('.endTurn') === 0){
		$(this).hide();
		$('.endTurn').eq(1).show()
		player2.totalMana++
		player2.currentMana = player2.totalMana
		updatePlayer(player2);
		 $('#hand1 .playcard').hide();
		draw(player2.hand, player2.deck, player2.elHand);
	} 
	if($(this).index('.endTurn') === 1){
		$(this).hide();
		$('.endTurn').eq(0).show()
		player1.totalMana++
		player1.currentMana = player1.totalMana
		updatePlayer(player1);
		$('#hand2 .playcard').hide();
		draw(player1.hand, player1.deck, player1.elHand);
	} 
	

})


/////////////////////// DRAW CARD

			$('#drawCard1').click(function(){
				if(player1.deck.length === 0){
					console.log('deck empty')
				}else{
					draw(player1.hand, player1.deck, player1.elHand);
			   	}
			})

			$('#drawCard2').click(function(){
				if(player2.deck.length === 0){
					console.log('deck empty')
				}else{
					draw(player2.hand, player2.deck,player2.elHand)
			   		}
			})

////////////////////////CAST/PLAY CARD
			$(document).on( 'click', '.playcard', function(){
				if(player1.hand.length === 0){
					console.log('hand empty');
				}else{
					index = $(this).index('.playcard');
					card = player1.hand[index];

					//Check mana
					if(player1.currentMana >= card.mana){
						player1.currentMana -= card.mana;
						player1.hand.splice(index,1);
					   	player1.board.push(card);
					   	updateBoard(player1.board, player1.elBoard);
					   	updateHand(player1.hand, player1.elHand);
					   	updatePlayer(player1);					
					   } else {
					   		alert("Not enough mana");
					   }
			   	}
			})


			$('#castCard2').click(function(){
				if(player2.hand.length === 0){
				console.log('hand 2 empty')
				}else{
				index = Math.floor(Math.random() * (player2.hand.length - 0)) + 0;
				card = player2.hand[index];
			   	player2.hand.splice(index,1);
			   	player2.board.push(card);
			   	updateBoard(player2.board, player2.elBoard);
			   	updateHand(player2.hand, player2.elHand);
			   		}
			})

/////////////////////////FUNCTIONS

				function hpCheck(board){
				  for(var i = 0; i <board.length; i++){
				    if(board[i].hp < 1){
				      board.splice(i,1);
				    }
				  }
				}

				function updateBoard(board, player){
					//update board
				  player.html('');
				  for(var i = 0; i<board.length;i++){
				     player.append(' ');
				      for(var k in board[i]){
				        var temp = k;
				        if(temp === 'name'){
				          temp = '';
				          player.append("<span class='bold'>"+ temp+" " + board[i][k] + "</span><br>");
				        }else{
				         player.append(k+": " + board[i][k]+"<br>");
				        }
				      }
				  }
				}

				  function updateHand(playerHand, playerHandEl){
				  	playerHandEl.html('');
					  for(var i = 0; i<playerHand.length;i++){
					     playerHandEl.append('<button class="playcard">Play</button>');
					      for(var k in playerHand[i]){
					        var temp = k;
					        if(temp === 'name'){
					          temp = '';
					          playerHandEl.append("<span class='bold'>"+ temp+" " + playerHand[i][k] + "</span><br>");
					        }else{
					         playerHandEl.append(k+": " + playerHand[i][k]+"<br>");
					        }
					      }
					  }
				}

				function updatePlayer(player){
					if(player.name == 'you'){
						$('.mana1').text(player.currentMana);
					}
					if(player.name == 'opponent'){
						$('.mana2').text(player.currentMana);
					}

					

				}

				

///////////////JUGGLE
			$('#juggle1').click(function(){
			   	var hitNumber = Math.floor(Math.random() * (player2.board.length - 0));
			   	if(player1.board.length<1){
			   		alert('nothing on the board to hit');
			   	}else{
			  	juggle(player2.board[hitNumber], player2.board, player2.elBoard);
			  	}
			})

			$('#juggle2').click(function(){
			   	var hitNumber = Math.floor(Math.random() * (player1.board.length - 0));
			   	if(player1.board.length < 1){
			   		alert('nothing on the board to hit')
			   	}else{
			  	juggle(player1.board[hitNumber], player1.board, player1.elBoard);
			  	}
			})

				function juggle(creature, board, player){
					creature.hp--;
				  	hpCheck(board);
				  	updateBoard(board, player);
				}
			
				function draw(playerHand, playerDeck, playerHandEl){
					var index = Math.floor(Math.random() * (playerDeck.length));
					playerHand.push(playerDeck[index]);
					console.log('drew: ');
					console.log(playerDeck[index]);
					playerDeck.splice(index,1);
					updateHand(playerHand, playerHandEl)
				}

////////////// INIT
	for(var i=0; i<3; i++){
		draw(player1.hand, player1.deck, player1.elHand);
		draw(player2.hand, player2.deck, player2.elHand);		
	}
	//draw(player1.hand, player1.deck, player1.elHand);
	updatePlayer(player1);
	updatePlayer(player2);

	</script>
</html>